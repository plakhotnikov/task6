<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Задание Слова – Вариант 1</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .controls {
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 70%;
            padding: 6px 8px;
            font-size: 14px;
        }

        button {
            padding: 6px 16px;
            margin-left: 8px;
            cursor: pointer;
        }

        /* Верхний блок 3 */
        #block3-wrapper {
            border: 1px solid #000;
            padding: 8px;
            margin-bottom: 15px;
        }

        #block3-title {
            margin-bottom: 5px;
            font-weight: bold;
        }

        #block3 {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 40px;
        }

        /* Нижние блоки 2 и 1 */
        .bottom {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        #block2-wrapper, #block1-wrapper {
            border: 1px solid #000;
            padding: 10px;
            flex: 1;
            min-height: 250px;
        }

        #block2-wrapper {
            border-color: #2b5bff; /* синий контур */
        }

        #block1-wrapper {
            /* общий чёрный контур, внутри красный блок */
        }

        #block2-title, #block1-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        #block2 {
            min-height: 200px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* красный блок 1 (для слов) */
        #output {
            border: 2px solid red;
            min-height: 40px;
            margin: 10px 0;
            padding: 6px;
            font-size: 18px;
        }

        #click-info {
            font-size: 13px;
            color: #444;
            background: #f3f3f3;
            border-radius: 6px;
            padding: 6px 8px;
        }

        /* Овальные элементы */
        .pill {
            padding: 6px 12px;
            border-radius: 999px;
            background: #d3d3d3;
            cursor: move;
            user-select: none;
            white-space: nowrap;
            border: 1px solid #777;
            font-size: 14px;
        }

        .pill.dragging {
            opacity: 0.4;
        }

        /* Подсветка контейнера при перетаскивании */
        .drop-target {
            min-height: 40px;
        }
        .drop-target.over {
            outline: 2px dashed #999;
        }
    </style>
</head>
<body>
<h2>Задание «Слова» – вариант 1</h2>

<div class="controls">
    <input id="inputLine" type="text"
           placeholder="Введите строку, слова через тире, например: лес - бочка-бык- крик - 3 - Бок">
    <button id="parseBtn">Разобрать</button>
</div>

<!-- Блок 3 -->
<div id="block3-wrapper">
    <div id="block3-title">Блок 3 (исходные отсортированные элементы)</div>
    <div id="block3" class="drop-target"></div>
</div>

<div class="bottom">
    <!-- Блок 2 -->
    <div id="block2-wrapper">
        <div id="block2-title">Блок 2 (сюда перетаскиваем элементы)</div>
        <div id="block2" class="drop-target"></div>
    </div>

    <!-- Блок 1 -->
    <div id="block1-wrapper">
        <div id="block1-title">Блок 1 (красное поле + информация)</div>
        <div id="output"></div>
        <div id="click-info">Нажмите на элемент в синем блоке, чтобы слово появилось здесь.</div>
    </div>
</div>

<script>
    const input = document.getElementById('inputLine');
    const parseBtn = document.getElementById('parseBtn');
    const block3 = document.getElementById('block3');
    const block2 = document.getElementById('block2');
    const output = document.getElementById('output');
    const clickInfo = document.getElementById('click-info');

    let items = {}; // id -> объект
    let dragItemId = null;

    parseBtn.addEventListener('click', () => {
        const line = input.value.trim();
        if (!line) {
            alert('Введите строку со словами, разделёнными тире "-"');
            return;
        }
        createItemsFromLine(line);
    });

    function createItemsFromLine(line) {
        items = {};
        block3.innerHTML = '';
        block2.innerHTML = '';
        output.innerHTML = '';
        clickInfo.textContent = 'Нажмите на элемент в синем блоке, чтобы слово появилось здесь.';

        const rawParts = line.split('-').map(p => p.trim()).filter(p => p.length > 0);

        const lower = [];
        const upper = [];
        const numbers = [];

        rawParts.forEach(word => {
            if (/^\d+$/.test(word)) {
                numbers.push(word);
            } else {
                const first = word.charAt(0);
                if (/[a-zа-яё]/.test(first)) {
                    lower.push(word);
                } else if (/[A-ZА-ЯЁ]/.test(first)) {
                    upper.push(word);
                } else {
                    // не буква/цифра – считаем как строчную
                    lower.push(word);
                }
            }
        });

        const locale = 'ru';
        lower.sort((a, b) => a.localeCompare(b, locale));
        upper.sort((a, b) => a.localeCompare(b, locale));
        numbers.sort((a, b) => Number(a) - Number(b));

        let all = [];

        lower.forEach((w, index) => {
            all.push({ key: 'a' + (index + 1), value: w, type: 'wordLower' });
        });
        upper.forEach((w, index) => {
            all.push({ key: 'b' + (index + 1), value: w, type: 'wordUpper' });
        });
        numbers.forEach((w, index) => {
            all.push({ key: 'n' + (index + 1), value: w, type: 'number' });
        });

        all.forEach((obj, idx) => {
            const id = 'item-' + idx;
            obj.id = id;
            obj.originalIndex = idx;
            obj.originalColor = '#d3d3d3';
            obj.randomColor = null;
            obj.clicks = 0;
            items[id] = obj;
            block3.appendChild(createPillElement(obj));
        });
    }

    function createPillElement(obj) {
        const div = document.createElement('div');
        div.className = 'pill';
        div.draggable = true;
        div.id = obj.id;
        div.textContent = obj.key + ' ' + obj.value;
        div.style.backgroundColor = obj.originalColor;
        div.dataset.key = obj.key;
        div.dataset.value = obj.value;
        div.dataset.originalIndex = obj.originalIndex;

        div.addEventListener('dragstart', (e) => {
            dragItemId = obj.id;
            div.classList.add('dragging');
            e.dataTransfer.setData('text/plain', obj.id);
        });

        div.addEventListener('dragend', () => {
            div.classList.remove('dragging');
            dragItemId = null;
        });

        // клик – только если сейчас в блоке 2
        div.addEventListener('click', () => {
            if (div.parentElement && div.parentElement.id === 'block2') {
                handleClickOnPill(obj.id);
            }
        });

        return div;
    }

    function handleClickOnPill(id) {
        const obj = items[id];
        if (!obj) return;

        obj.clicks += 1;

        const span = document.createElement('span');
        span.textContent = (output.textContent ? ' ' : '') + obj.value;
        span.style.color = obj.randomColor || obj.originalColor;
        output.appendChild(span);

        // обновляем текст с количеством кликов
        const parts = Object.values(items)
            .filter(o => o.clicks > 0)
            .map(o => {
                const times = o.clicks;
                const wordForm = (times === 1) ? 'раз' :
                    (times >= 2 && times <= 4) ? 'раза' : 'раз';
                return `нажали ${times} ${wordForm} на элемент "${o.key} ${o.value}"`;
            });

        clickInfo.textContent = parts.length
            ? parts.join(', ')
            : 'Нажмите на элемент в синем блоке, чтобы слово появилось здесь.';
    }

    function randColor() {
        // мягкие случайные цвета
        const r = 100 + Math.floor(Math.random() * 155);
        const g = 100 + Math.floor(Math.random() * 155);
        const b = 100 + Math.floor(Math.random() * 155);
        return `rgb(${r},${g},${b})`;
    }

    // Работа с dnd для блоков 2 и 3
    [block2, block3].forEach(container => {
        container.addEventListener('dragover', (e) => {
            e.preventDefault();
            container.classList.add('over');
        });

        container.addEventListener('dragleave', () => {
            container.classList.remove('over');
        });

        container.addEventListener('drop', (e) => {
            e.preventDefault();
            container.classList.remove('over');

            const id = e.dataTransfer.getData('text/plain') || dragItemId;
            if (!id) return;
            const elem = document.getElementById(id);
            if (!elem) return;

            // если впервые переносим в блок 2 – задаём случайный цвет
            if (container.id === 'block2') {
                if (!items[id].randomColor) {
                    items[id].randomColor = randColor();
                }
                elem.style.backgroundColor = items[id].randomColor;
            }

            // если переносим обратно в блок 3 – восстанавливаем исходный цвет
            if (container.id === 'block3') {
                elem.style.backgroundColor = items[id].originalColor;
            }

            container.appendChild(elem);

            if (container.id === 'block3') {
                reorderBlock3();
            }
        });
    });

    function reorderBlock3() {
        const children = Array.from(block3.children);
        children.sort((a, b) => {
            return Number(a.dataset.originalIndex) - Number(b.dataset.originalIndex);
        });
        children.forEach(ch => block3.appendChild(ch));
    }
</script>
</body>
</html>